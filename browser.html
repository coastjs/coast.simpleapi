<!DOCTYPE html>
<html>
<head>
    <title>Coast Browser</title>
</head>
<body>
<script src="http://127.0.0.1:8080/ua"></script>
<script>
    /**
     * @param window represents a window containing a DOM document.
     * @see https://developer.mozilla.org/en-US/docs/Web/API/Window
     */
    (function (window) {
        /**
         * The load event fires at the end of the document loading process. At this point, all of the objects in the
         * document are in the DOM, and all the images, scripts, links and sub-frames have finished loading.
         * @see https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers.onload
         */
        window.onload = function () {
            /**
             * Notice that the only URL hard-coded within the entire application is the entry point of the API.
             * Everything else is followed by links and forms within responses. No HTTP semantics are used for creating
             * requests. They are only used for checking media types within responses.
             */
            function Notes() {
                return this;
            }

            Notes.entryPoint = 'http://127.0.0.1:8080/notes';

            Notes.list = function (callback) {
                hypermedia.Api.enter(Notes.entryPoint, function (error, res) {
                    if (res && res.status === 200 && res.headers['content-type'] === 'application/json') {
                        callback(JSON.parse(res.body));
                    } else callback(null);
                });
            };

            Notes.createNote = function (body, callback) {
                hypermedia.Api.enter(Notes.entryPoint, function () {
                    if (this.possible('createNote')) {
                        this.follow({ rel: 'createNote', body: body }, function (error, res) {
                            if (res && res.status === 201 && res.headers['content-type'] === 'application/json') {
                                callback(JSON.parse(res.body));
                            } else callback(null);
                        });
                    } else callback(null);
                });
            };

            Notes.retrieveNote = function (uri, callback) {
                hypermedia.Api.enter(Notes.entryPoint, function () {
                    if (this.possible('retrieveNote')) {
                        this.follow({ rel: 'retrieveNote', uri: uri }, function (error, res) {
                            if (res && res.status === 200 && res.headers['content-type'] === 'application/json') {
                                callback(JSON.parse(res.body));
                            } else callback(null);
                        });
                    } else callback(null);
                });
            };

            Notes.removeNote = function (uri, callback) {
                hypermedia.Api.enter(Notes.entryPoint, function () {
                    if (this.possible('removeNote')) {
                        this.follow({ rel: 'removeNote', uri: uri }, function (error, res) {
                            callback(res && res.status === 200 || res.status === 204);
                        });
                    } else callback(false);
                });
            };

            Notes.list(function (notes) {
                if (notes) {
                    console.log('Listing Notes: ' + JSON.stringify(notes, null, ' '));
                    Notes.createNote({ title: 'New Note.' }, function (note) {
                        if (note) {
                            console.log('Created Note: ' + JSON.stringify(note, null, ' '));
                            Notes.list(function (notes) {
                                if (notes) {
                                    console.log('Listing Notes: ' + JSON.stringify(notes, null, ' '));
                                    for (var id in notes) {
                                        Notes.retrieveNote({ id: id }, function (note) {
                                            if (note) {
                                                console.log('Retrieved Note: ' + JSON.stringify(note, null, ' '));
                                                Notes.removeNote({ id: note.id }, function (removed) {
                                                    if (removed) {
                                                        console.log('Removed Note.');
                                                    } else console.log('Failed to remove Note.');
                                                });
                                            } else console.log('Failed to retrieve Note.');
                                        });
                                    }
                                } else console.log('Failed to list Notes.');
                            });
                        } else console.log('Failed to create Note.');
                    });
                } else console.log('Failed to list Notes.');
            });
        };
    })(window);
</script>
</body>
</html>
